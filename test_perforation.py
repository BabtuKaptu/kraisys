#!/usr/bin/env python3
"""–¢–µ—Å—Ç —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —Ç–∏–ø–æ–≤ –ø–µ—Ä—Ñ–æ—Ä–∞—Ü–∏–∏"""

import sys
from PyQt6.QtWidgets import QApplication, QMessageBox
from database.connection import DatabaseConnection
from ui.references.perforation_types_view import PerforationTypesTableWidget, PerforationTypeEditForm

def test_perforation():
    """–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–ø–∏—Å–∏ –ø–µ—Ä—Ñ–æ—Ä–∞—Ü–∏–∏"""
    app = QApplication(sys.argv)

    try:
        # –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ —Ç–∞–±–ª–∏—Ü—ã
        print("üîπ –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞ —Ç–∞–±–ª–∏—Ü—ã –ø–µ—Ä—Ñ–æ—Ä–∞—Ü–∏–π...")
        table_widget = PerforationTypesTableWidget()
        print("‚úÖ –í–∏–¥–∂–µ—Ç —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ")

        # –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        print("üîπ –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...")
        edit_form = PerforationTypeEditForm()
        print("‚úÖ –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ")

        # –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ table_name
        print("üîπ –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ table_name...")
        print(f"table_name –≤ —Ñ–æ—Ä–º–µ: {edit_form.table_name}")

        if edit_form.table_name == 'perforation_types':
            print("‚úÖ table_name —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ")
        else:
            print(f"‚ùå table_name –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: {edit_form.table_name}")

        # –¢–µ—Å—Ç 4: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        print("üîπ –¢–µ—Å—Ç 4: –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏...")
        edit_form.code_input.setText("TEST-001")
        edit_form.name_input.setText("–¢–µ—Å—Ç–æ–≤–∞—è –ø–µ—Ä—Ñ–æ—Ä–∞—Ü–∏—è")
        edit_form.description_input.setPlainText("–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –ø–µ—Ä—Ñ–æ—Ä–∞—Ü–∏–∏")
        print("‚úÖ –§–æ—Ä–º–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏")

        # –¢–µ—Å—Ç 5: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–æ—Ä–º—ã
        print("üîπ –¢–µ—Å—Ç 5: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–æ—Ä–º—ã...")
        form_data = edit_form.get_form_data()
        print(f"–î–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã: {form_data}")
        print("‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ")

        # –¢–µ—Å—Ç 6: –í–∞–ª–∏–¥–∞—Ü–∏—è
        print("üîπ –¢–µ—Å—Ç 6: –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã...")
        errors = edit_form.validate_form()
        if errors:
            print(f"‚ùå –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏: {errors}")
        else:
            print("‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ")

        # –¢–µ—Å—Ç 7: –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
        print("üîπ –¢–µ—Å—Ç 7: –ü–æ–∫–∞–∑ —Ñ–æ—Ä–º—ã –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞...")
        edit_form.show()

        print("üéØ –í—Å–µ —Ç–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. –¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ —Ñ–æ—Ä–º–µ...")
        print("   (–Ω–∞–∂–º–∏—Ç–µ Save –≤ –æ—Ç–∫—Ä—ã–≤—à–µ–π—Å—è —Ñ–æ—Ä–º–µ)")

        app.exec()

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏: {e}")
        import traceback
        traceback.print_exc()

if __name__ == "__main__":
    test_perforation()